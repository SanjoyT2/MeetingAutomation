<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Processing App</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .section {
        margin-bottom: 20px;
      }
      textarea {
        width: 100%;
        height: 100px;
      }
      .error {
        color: red;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        display: none;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <h1>Audio Processing App</h1>

    <div class="section">
      <h2>Upload Audio</h2>
      <input type="file" id="audioFile" accept="audio/*" />
      <button onclick="handleUpload()">Upload</button>
      <div class="loader" id="uploadLoader"></div>
      <p id="uploadResult"></p>
    </div>

    <div class="section">
      <h2>Transcribe Audio</h2>
      <input type="text" id="filename" placeholder="Filename from upload" />
      <button onclick="handleTranscribe()">Transcribe</button>
      <div class="loader" id="transcribeLoader"></div>
      <textarea id="transcription" readonly></textarea>
      <p id="transcribeError" class="error"></p>
    </div>

    <div class="section">
      <h2>Summarize Text</h2>
      <textarea
        id="textToSummarize"
        placeholder="Enter text to summarize"
      ></textarea>
      <button onclick="handleSummarize()">Summarize</button>
      <div class="loader" id="summarizeLoader"></div>
      <textarea id="summary" readonly></textarea>
      <p id="summarizeError" class="error"></p>
    </div>

    <script src="audio-services.js"></script>
    <script>
      function showLoader(id) {
        document.getElementById(id).style.display = "inline-block";
      }

      function hideLoader(id) {
        document.getElementById(id).style.display = "none";
      }

      async function handleUpload() {
        const fileInput = document.getElementById("audioFile");
        const file = fileInput.files[0];
        if (!file) {
          alert("Please select a file");
          return;
        }

        showLoader("uploadLoader");
        document.getElementById("uploadResult").textContent = "";

        try {
          const result = await AudioServices.uploadAudio(file);
          document.getElementById(
            "uploadResult"
          ).textContent = `File uploaded: ${result.filename}`;
          document.getElementById("filename").value = result.filename;
        } catch (error) {
          document.getElementById("uploadResult").textContent =
            "Error uploading file: " + error.message;
        } finally {
          hideLoader("uploadLoader");
        }
      }

      async function handleTranscribe() {
        const filename = document.getElementById("filename").value;
        if (!filename) {
          alert("Please enter a filename");
          return;
        }

        showLoader("transcribeLoader");
        document.getElementById("transcribeError").textContent = "";
        document.getElementById("transcription").value = "";

        try {
          const result = await AudioServices.transcribeAudio(filename);
          if (result.transcription) {
            document.getElementById("transcription").value =
              result.transcription;
            document.getElementById("textToSummarize").value =
              result.transcription;
          } else {
            throw new Error("Transcription not found in response");
          }
        } catch (error) {
          document.getElementById("transcribeError").textContent =
            "Error transcribing audio: " + error.message;
        } finally {
          hideLoader("transcribeLoader");
        }
      }

      async function handleSummarize() {
        const text = document.getElementById("textToSummarize").value;
        if (!text) {
          alert("Please enter text to summarize");
          return;
        }

        showLoader("summarizeLoader");
        document.getElementById("summarizeError").textContent = "";
        document.getElementById("summary").value = "";

        try {
          const result = await AudioServices.summarizeText(text);
          if (result.summary) {
            document.getElementById("summary").value = result.summary;
          } else {
            throw new Error("Summary not found in response");
          }
        } catch (error) {
          document.getElementById("summarizeError").textContent =
            "Error summarizing text: " + error.message;
        } finally {
          hideLoader("summarizeLoader");
        }
      }
    </script>
  </body>
</html>
